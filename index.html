<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Valley Lite (Web)</title>
<style>html,body{margin:0;height:100%;background:#0f1418;color:#eaf2f9;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Helvetica Neue",Arial}canvas{width:100%;height:100%;display:block}</style>
</head>
<body>
<canvas id="game"></canvas>
<script>","use strict";(()=>{const TILE=28,W=64,H=64,DAY=360,TOOLS=["hoe","water","seed","hand"];const CROPS={turnip:{n:"Turnip",buy:20,sell:45,d:3,c:"#b8e07c"}};const S={w:mk(W,H),p:{x:10,y:10,fx:0,fy:1,spd:5,tool:0,seed:"turnip",money:200,sd:{turnip:6}},t:{d:1,s:8*3600},cam:{x:10*TILE,y:10*TILE},ui:{m:""},loc:{bed:{x:7,y:7},house:{x:5,y:5,w:7,h:7}}};function mk(w,h){const a=Array(h);for(let y=0;y<h;y++){const r=Array(w);for(let x=0;x<w;x++){r[x]={t:"grass",wet:false,c:null,b:false};}a[y]=r;}return a;}function B(x,y){return x>=0&&y>=0&&x<W&&y<H;}function T(x,y){return S.w[y][x];}function till(x,y){if(!B(x,y))return false;const t=T(x,y);if(t.t==="grass"){t.t="soil";t.wet=false;return true;}return false;}function water(x,y){if(!B(x,y))return false;const t=T(x,y);if(t.t==="soil"||t.t==="crop"){t.wet=true;return true;}return false;}function plant(x,y,k){if(!B(x,y))return false;const t=T(x,y);if((t.t==="soil"||t.t==="crop")&&!t.c){t.t="crop";t.c={k,stage:0,days:0};return true;}return false;}function harvest(x,y){const t=T(x,y);if(t&&t.c){const d=CROPS[t.c.k];if(t.c.stage>=d.d){t.c=null;t.t="soil";t.wet=false;S.p.money+=d.sell;msg("Sold "+d.n+" +$"+d.sell);return true;}}return false;}function endDay(){for(let y=0;y<H;y++){for(let x=0;x<W;x++){const t=T(x,y);if(t.c&&t.wet){t.c.days++;const d=CROPS[t.c.k];t.c.stage=Math.min(d.d,t.c.days);}t.wet=false;}}S.t.d++;S.t.s=6*3600;}const I={L:false,R:false,U:false,D:false,A:false,E:false,keys:new Set()};addEventListener("keydown",e=>{I.keys.add(e.key);if(["ArrowLeft","a","A"].includes(e.key))I.L=true;if(["ArrowRight","d","D"].includes(e.key))I.R=true;if(["ArrowUp","w","W"].includes(e.key))I.U=true;if(["ArrowDown","s","S"].includes(e.key))I.D=true;if([" ","e","E"].includes(e.key))I.A=true;if(["1","2","3","4"].includes(e.key))S.p.tool=parseInt(e.key)-1;if(e.key==="q"||e.key==="Q")S.p.seed=(S.p.seed==="turnip"?"turnip":"turnip");if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","e","E"].includes(e.key))e.preventDefault();});addEventListener("keyup",e=>{I.keys.delete(e.key);if(["ArrowLeft","a","A"].includes(e.key))I.L=false;if(["ArrowRight","d","D"].includes(e.key))I.R=false;if(["ArrowUp","w","W"].includes(e.key))I.U=false;if(["ArrowDown","s","S"].includes(e.key))I.D=false;if([" ","e","E"].includes(e.key))I.A=false;});const C=document.getElementById("game"),X=C.getContext("2d");function fit(){const dpr=Math.max(1,Math.min(2,devicePixelRatio||1));const r=C.getBoundingClientRect();C.width=Math.floor(r.width*dpr);C.height=Math.floor(r.height*dpr);X.setTransform(dpr,0,0,dpr,0,0);}addEventListener("resize",fit);function draw(){X.fillStyle="#1a2b38";X.fillRect(0,0,C.width,C.height);const left=S.cam.x-C.width/2,top=S.cam.y-C.height/2;const wTiles=Math.ceil(C.width/TILE)+2,hTiles=Math.ceil(C.height/TILE)+2;const sx=Math.floor(left/TILE),sy=Math.floor(top/TILE);for(let ty=0;ty<hTiles;ty++){for(let tx=0;tx<wTiles;tx++){const wx=sx+tx,wy=sy+ty;if(!B(wx,wy))continue;const t=T(wx,wy);const px=tx*TILE-(left%TILE),py=ty*TILE-(top%TILE);if(t.t==="grass")X.fillStyle="#244d2b";else if(t.t==="soil"||t.t==="crop")X.fillStyle="#5a3b2e";else X.fillStyle="#2b4f31";X.fillRect(px,py,TILE,TILE);if((t.t==="soil"||t.t==="crop")&&t.wet){X.fillStyle="rgba(80,120,200,.25)";X.fillRect(px,py,TILE,TILE);}if(t.t==="crop"&&t.c){const d=CROPS[t.c.k];const h=Math.floor((t.c.stage/d.d)*(TILE-6))+4;X.fillStyle=d.c;X.fillRect(px+6,py+(TILE-h),TILE-12,h);}X.strokeStyle="rgba(0,0,0,.08)";X.strokeRect(px,py,TILE,TILE);}}drawPlayer();}function drawPlayer(){const left=S.cam.x-C.width/2,top=S.cam.y-C.height/2;const px=S.p.x*TILE-left,py=S.p.y*TILE-top;X.fillStyle="rgba(0,0,0,.25)";X.beginPath();X.ellipse(px,py+9,9,4,0,0,6.283);X.fill();X.fillStyle="#e2b58d";X.fillRect(px-6,py-16,12,12);X.fillStyle="#3b6ea8";X.fillRect(px-8,py-6,16,12);X.fillStyle="#333";X.fillRect(px-8,py+6,16,8);}function update(dt){S.t.s+=dt*DAY;const dx=(I.R?1:0)-(I.L?1:0),dy=(I.D?1:0)-(I.U?1:0);const n=Math.hypot(dx,dy)||1;const nx=dx/n,ny=dy/n;S.p.x=Math.max(0,Math.min(W-0.001,S.p.x+nx*S.p.spd*dt));S.p.y=Math.max(0,Math.min(H-0.001,S.p.y+ny*S.p.spd*dt));if(dx||dy){S.p.fx=nx;S.p.fy=ny;}S.cam.x+=((S.p.x*TILE)-S.cam.x)*.2;S.cam.y+=((S.p.y*TILE)-S.cam.y)*.2;if(I.A){interact();I.A=false;}}function interact(){const tx=Math.floor(S.p.x+Math.sign(S.p.fx||0)),ty=Math.floor(S.p.y+Math.sign(S.p.fy||0));const tool=TOOLS[S.p.tool];if(tool==="hoe"){till(tx,ty);}else if(tool==="water"){water(tx,ty);}else if(tool==="seed"){if(S.p.sd.turnip>0){if(plant(tx,ty,"turnip")){S.p.sd.turnip--;}}}else if(tool==="hand"){harvest(tx,ty);} }let lt=0;function loop(ts){if(!lt)lt=ts;const dt=(ts-lt)/1000;lt=ts;update(dt);draw();requestAnimationFrame(loop);}fit();requestAnimationFrame(loop);} )();
</script>
</body>
</html>
